import csv
import os
import random
import math
import sys


# print("\n*********************************************************************************");
# print("frequency.py")
# sys.stdout.write("Directory ")
# print(os.getcwd())
# print("Created by Brock Tubre on 11/07/14 -- CSC475")
# print("*********************************************************************************\n");



# stores input csv files values
values = []
# 2d array to store trasition frequencies
transitions = [[0 for x in range(256)] for x in range(256)]
# list to stores wieghts for each transition
weights = [0.01 for x in range(256*256)]
bias = 1
alpha = 0.5

CSVfilelist = ['output.csv', 'Blurb.csv', 'output1.csv']

# Reads in CSV file and stores frequencies into transition[][] list
def FrequencyFunc(inputCSV):
	original = open(inputCSV, 'rU')
	reader = csv.reader(original)
	for row in reader:
		values = row

	# re initialize transitions list
	transitions = [[0 for x in range(256)] for x in range(256)]

	for i in range(len(values)):
		if(int(values[i]) > 0 and int(values[i+1]) > 0):
			first = int(values[i])
			second = int(values[i+1])
			transitions[first][second] += 1

	return transitions

def LearningFunc(csvfile):
	trans = FrequencyFunc(csvfile)
	hyp = Hypothesis(trans)
	error = trans[255][255] * 2 - 1 - hyp
	print("Error is: %s" % error)
	print("Mal value: %s" % trans[255][255])
	print(" ")
	k = 0
	for i in range(255):
		for j in range(255):
			weights[i] = weights[i] + alpha * error * trans[i][j]
			k += 1
	weights[256*256-1] = weights[256*256-1] + alpha * error * bias


def Hypothesis(trans):
	k = 0
	summer = 0
	for i in range(255):
		for j in range(255):
			summer += weights[k] * trans[i][j]
			k += 1
	summer += bias * weights[256*256-1]
	print("Sum is: %s" % summer)
	if(summer > 1):
		return 1
	else:
		return -1

for i in range(150):
	print("Iteration: %s" % i)
	randomCSV = random.randint(0, 2)
	LearningFunc(CSVfilelist[randomCSV])
	alpha = alpha / 1.001


# def PrintCSV(T):			
# 	# prints the frequencies of each transition
# 	for j in range(256):
# 		for k in range(256):
# 			count = T[j][k]
# 			if(count != 0):
# 				#sys.stdout.write("%s, %s, %s \n" % (j, k, count))
# 				sys.stdout.write("%s, %s, %s \n" % (j, k, count))



# PrintCSV(FrequencyFunc())		













